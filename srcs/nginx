FROM debian:bullseye-slim

RUN apt-get update && apt-get install -y build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev openssl wget

RUN wget http://nginx.org/download/nginx-1.21.1.tar.gz && tar -xzvf nginx-1.21.1.tar.gz

RUN wget https://www.openssl.org/source/openssl-1.1.1k.tar.gz && tar -xzvf openssl-1.1.1k.tar.gz

RUN cd nginx-1.21.1 && ./configure --with-openssl=../openssl-1.1.1k --with-http_ssl_module --with-http_v2_module && make && make install

RUN apt-get remove -y build-essential libpcre3-dev zlib1g-dev libssl-dev wget && apt-get autoremove -y && apt-get clean

EXPOSE 443

CMD ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]